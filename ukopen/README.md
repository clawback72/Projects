# British Open 2024 POOL TRACKING
#### Project Overview:
This project was created to track a friendly British Open pool amongst a few family and friends, keeping participants updated on the standing of the pool as the tournament progressed.  Tournament scoring data is retrieved from the pgatour.com website and updates are pushed to Google sheets to provide participants with live updates.  The initial rules for the pool were for each participant to pick five golfers and the participant with the highest total prize money won for his selected golfers would win the pool.  However, it was ultimately agreed to change the criteria for the winner to be lowest net over/under score aggregate across their golfers.  BeautifulSoup is used to scrape the JSON from https://www.pgatour.com/leaderboard to supply live data to a Google Sheets document.  Data aggregation and sorting is primarily done using pandas and numpy modules.
### Files / Directories Included:
- **/data_backup** - This directory was created to save the JSON from pgatour.com after selected data pulls.
- **ukopen_2024.py** - This file contains all of the code for data analysis and printing results to console, but does not include code for writing data to Google Sheets.  This file should be used if you wish to test the script locally.  Data is pulled from the last JSON in /data_backup and all code for pulling live data from pgatour.com is commented out, but present.
- **ukopen_2024_2.py** - This file contains all code from masters.py with the addition of support for writing to Google Sheets.  If you wish to use this functionality, you will have to provide a link to your own Google Cloud project and service account credentials.  Data is pulled from the last JSON in /data_backup and all code for pulling live data from pgatour.com is commented out, but present.  You can see the last updated version of the google sheet for this project [here.](https://docs.google.com/spreadsheets/d/1B82nFMxUa4ESKt3z2l8LHVPNBGMgp16tiGgOOBkjSZI/edit?gid=0#gid=0)
- **logfile.log** - ouput from the crontab job scheduled to run ukopen_2024_2.py every 10 minutes from 1AM through 5PM.  Used for error and performance tracking.
- **requirements.txt** - list of required python modules
- **golfers.csv** - this is a CSV dump of the formatted dataframe from the get_data() function.  It can be created by uncommenting line 220 in ukopen_2024_2.py.  This is useful for getting a look at the data for troubleshooting, or for extracting the tournament field and golfers unique 'PlayerID' when defining participant picks.  The file provided here was created after completion of the tournament.
### Functions in masters2.py
- **def main():** - Prior to kicking into main() the program initializes and sets up defaults for writing to Google Sheets.  Once in main(), it begins by defining participant selections by golfer ID using a simple dictionary.  Due to the small number of participants, this was the easiest way to define the data - may create separate function for this in the future.  The rest of the function deals with getting the leaderboard dataframe by calling get_data(), then sorting the data and printing to the terminal and Google Sheets.  The first section displays a compact ordered leaderboard for the standings of the pool.  The second section provides an ordered detailed summary of the performance of each golfer for each participant.
- **def get_data():** - This function pulls the JSON from https://www.pgatour.com/leaderboard, extracts the relevant leaderboard data into a dataframe, performs some formatting on the data and calculates additional columns for the returned dataframe, notably the Position, Points, Rank and Projected winnings columns.
- **def assign_rank(position):** - This function was created when the pool winner was going to be determined by money won.  I couldn't find an algorithm for determining the prize money distribution, so I created estimates based on the 2023 money distribution.  To do so, I needed to establish the rank of each golfer, grouping ties, which is what this function returns for the series 'Position'.
- **def get_price_money(rank):** - Returns estimated prize money for the series 'Rank'
- **def save_json(data):** - Creates a backup of each JSON pulled in case there were any changes in the data.  There was an issue that required some code changes when on day two of the tournament, another element was added to the data to establish the projected cut line.  If there were any further issues I wanted to be able to quickly determine the cause.  During normal operation, this function is only called at the top of each hour.
- **def teeTime(time_m, backNine):** - This function is called when the 'Thru' field for a given golfer is blank, indicating they have not yet teed off for the current day.  It takes the golfers starting tee time in milliseconds (time_m) and returns it formatted in HH:MM adjusted for EST.  Additionally, boolean value backNine is provided.  If backNine is true, this means the player is teeing off the 10th tee, and an asterisk will be appended to the formatted tee time before it is returned.